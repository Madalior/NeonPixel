<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeonPixel | Premium Wallpapers</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* CSS Base */
        :root { --bg-dark: #0a0a0a; --bg-card: #141414; --bg-hover: #1f1f1f; --accent: #00FFFF; --text-main: #ffffff; --text-muted: #a0a0a0; --nav-height: 70px; }
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body { font-family: 'Outfit', sans-serif; background-color: var(--bg-dark); color: var(--text-main); overflow-x: hidden; }
        
        /* Header */
        header { position: fixed; top: 0; width: 100%; height: var(--nav-height); background: rgba(10,10,10,0.9); backdrop-filter: blur(10px); z-index: 1000; display: flex; align-items: center; justify-content: space-between; padding: 0 5%; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .logo { font-size: 1.5rem; font-weight: 700; color: var(--text-main); display: flex; align-items: center; gap: 10px; } 
        .logo span { color: var(--accent); }

        .nav-links { display: flex; gap: 20px; }
        .nav-btn { background: none; border: none; color: var(--text-muted); font-size: 1rem; cursor: pointer; font-weight: 600; transition: 0.3s; }
        .nav-btn:hover, .nav-btn.active { color: var(--text-main); }
        .nav-btn.active { border-bottom: 2px solid var(--accent); }

        /* Device Switcher (NEW) */
        .device-selector {
            display: flex; justify-content: center; gap: 20px; margin-top: 100px; margin-bottom: 20px;
        }
        .device-btn {
            background: var(--bg-card); border: 1px solid #333; color: var(--text-muted);
            padding: 12px 30px; border-radius: 8px; cursor: pointer; font-size: 1.1rem;
            display: flex; align-items: center; gap: 10px; transition: all 0.3s ease;
        }
        .device-btn i { font-size: 1.2rem; }
        .device-btn.active {
            background: var(--accent); color: #000; font-weight: bold; border-color: var(--accent);
            box-shadow: 0 0 15px rgba(0,255,255,0.3);
        }
        .device-btn:hover { transform: translateY(-2px); }

        /* Search & Cats */
        .search-container { max-width: 500px; margin: 0 auto 30px; position: relative; padding: 0 20px; }
        .search-bar { width: 100%; padding: 15px 20px 15px 45px; border-radius: 50px; border: 1px solid #333; background: var(--bg-card); color: white; font-size: 1rem; }
        .search-icon { position: absolute; left: 35px; top: 50%; transform: translateY(-50%); color: #666; }
        
        .category-scroll { display: flex; gap: 10px; overflow-x: auto; padding: 10px 5%; margin-bottom: 30px; justify-content: center; }
        .cat-chip { padding: 8px 20px; border-radius: 50px; background: var(--bg-card); border: 1px solid #333; color: var(--text-muted); cursor: pointer; transition: 0.3s; }
        .cat-chip.active { background: #fff; color: #000; font-weight: bold; }

        /* Grid */
        .gallery-container { padding: 0 5%; }
        .masonry-grid { column-count: 4; column-gap: 20px; }
        /* Responsive Grid */
        @media (max-width: 1200px) { .masonry-grid { column-count: 3; } }
        @media (max-width: 768px) { .masonry-grid { column-count: 2; } }
        @media (max-width: 480px) { .masonry-grid { column-count: 1; } }

        .grid-item { break-inside: avoid; margin-bottom: 20px; border-radius: 12px; overflow: hidden; position: relative; cursor: pointer; transition: transform 0.3s; }
        .grid-item:hover { transform: translateY(-5px); }
        .grid-item img { width: 100%; display: block; }
        
        .overlay { position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); opacity: 0; transition: 0.3s; }
        .grid-item:hover .overlay { opacity: 1; }

        /* Modal */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .modal.open { display: flex; }
        .modal-content { max-width: 90%; max-height: 90%; position: relative; text-align: center; }
        .modal-content img { max-width: 100%; max-height: 80vh; border-radius: 8px; box-shadow: 0 0 30px rgba(0,255,255,0.2); }
        .download-btn { display: inline-block; margin-top: 15px; padding: 12px 30px; background: var(--accent); color: #000; text-decoration: none; border-radius: 5px; font-weight: bold; }
        .close-modal { position: absolute; top: -40px; right: 0; color: white; font-size: 2rem; cursor: pointer; }

    </style>
</head>
<body>

    <header>
        <div class="logo"><i class="fa-solid fa-layer-group"></i> Neon<span>Pixel</span></div>
        <nav class="nav-links">
            <button class="nav-btn active" onclick="switchTab('wallpapers')">Wallpapers</button>
            <button class="nav-btn" onclick="switchTab('videos')">Live Loops</button>
        </nav>
    </header>

    <div class="device-selector">
        <div class="device-btn active" onclick="setDevice('mobile')">
            <i class="fa-solid fa-mobile-screen"></i> Mobile
        </div>
        <div class="device-btn" onclick="setDevice('desktop')">
            <i class="fa-solid fa-desktop"></i> Desktop
        </div>
    </div>

    <div class="search-container">
        <i class="fa-solid fa-search search-icon"></i>
        <input type="text" id="searchInput" class="search-bar" placeholder="Search..." onkeyup="renderGallery()">
    </div>

    <div class="category-scroll" id="categoryList"></div>

    <main class="gallery-container">
        <div class="masonry-grid" id="galleryGrid"></div>
    </main>

    <div class="modal" id="imageModal">
        <div class="modal-content">
            <div class="close-modal" onclick="closeModal()">&times;</div>
            <div id="modalPreview"></div>
            <a href="#" id="modalDownload" class="download-btn" target="_blank" download>Download 4K</a>
        </div>
    </div>

    <script>
        let allWallpapers = [];
        let videos = [];
        const categories = ["All", "Anime", "Cars", "Nature", "Gaming", "Cyberpunk", "Abstract"];
        
        // State
        let currentTab = 'wallpapers';
        let currentDevice = 'mobile'; // Default to mobile
        let currentCategory = 'All';

        document.addEventListener('DOMContentLoaded', loadData);

        async function loadData() {
            try {
                // Load Images
                const wpRes = await fetch("data/cloud_wallpapers.json");
                if (wpRes.ok) {
                    const data = await wpRes.json();
                    allWallpapers = data.map(item => ({
                        ...item,
                        // Determine device if missing (fallback for old data)
                        device: item.device || 'mobile' 
                    }));
                }

                // Load Videos
                const vidRes = await fetch("data/videos.json");
                if (vidRes.ok) {
                    const vData = await vidRes.json();
                    videos = vData.map(item => ({ ...item, device: 'mobile' })); // Videos are mostly mobile
                }

                renderCategories();
                renderGallery();
            } catch (e) { console.error("Load failed", e); }
        }

        // --- NEW: Switch Device Logic ---
        function setDevice(device) {
            currentDevice = device;
            // Update UI buttons
            document.querySelectorAll('.device-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // Refresh Gallery
            renderGallery();
        }

        function renderGallery() {
            const container = document.getElementById('galleryGrid');
            const source = currentTab === 'wallpapers' ? allWallpapers : videos;
            const search = document.getElementById('searchInput').value.toLowerCase();

            // Filter by: 1. Tab Type, 2. Device Type, 3. Category, 4. Search Text
            const filtered = source.filter(item => {
                const matchDevice = (currentTab === 'videos') ? true : (item.device === currentDevice);
                const matchCat = currentCategory === 'All' || item.category === currentCategory;
                const matchSearch = item.title.toLowerCase().includes(search);
                return matchDevice && matchCat && matchSearch;
            });

            container.innerHTML = filtered.map(item => `
                <div class="grid-item fade-in" onclick='openModal(${JSON.stringify(item)})'>
                    ${item.type === 'image' 
                        ? `<img src="${item.src.replace('/upload/', '/upload/w_500,f_auto,q_auto/')}" loading="lazy">` 
                        : `<video src="${item.src}" muted loop onmouseover="this.play()" onmouseout="this.pause()"></video>`}
                    <div class="overlay">
                        <h3>${item.title}</h3>
                    </div>
                </div>
            `).join('');
            
            if (filtered.length === 0) container.innerHTML = '<p style="text-align:center; color:#666;">No wallpapers found for this device/category.</p>';
        }

        function renderCategories() {
            document.getElementById('categoryList').innerHTML = categories.map(cat => `
                <div class="cat-chip ${cat === 'All' ? 'active' : ''}" onclick="setCat(this, '${cat}')">${cat}</div>
            `).join('');
        }

        function setCat(el, cat) {
            currentCategory = cat;
            document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            renderGallery();
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderGallery();
        }

        // Modal Logic
        function openModal(item) {
            const modal = document.getElementById('imageModal');
            const preview = document.getElementById('modalPreview');
            const btn = document.getElementById('modalDownload');
            
            if (item.type === 'image') {
                preview.innerHTML = `<img src="${item.src}" alt="${item.title}">`;
            } else {
                preview.innerHTML = `<video src="${item.src}" controls autoplay loop></video>`;
            }
            btn.href = item.src;
            modal.classList.add('open');
        }
        function closeModal() {
            document.getElementById('imageModal').classList.remove('open');
            document.getElementById('modalPreview').innerHTML = '';
        }
    </script>
</body>
</html>